<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Borak Dashboard v4</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    box-sizing: border-box;
  }
  *, *::before, *::after { box-sizing: inherit; }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
    padding-top: env(safe-area-inset-top, 12px);
  }

  header {
    padding: 12px 16px;
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(12px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    font-size: 18px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 10;
  }

  header #menuToggle {
    font-size: 24px;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 8px;
    transition: background 0.2s;
  }
  header #menuToggle:hover { background: rgba(255,255,255,0.1); }

  #usersSection {
    position: fixed;
    top: 0;
    left: -100%;
    width: 280px;
    max-width: 90%;
    height: 100%;
    background: rgba(30,30,30,0.95);
    backdrop-filter: blur(10px);
    overflow-y: auto;
    transition: left 0.3s ease;
    z-index: 1000;
    padding: 20px;
  }
  #usersSection.show { left: 0; }

  #usersSection h2 { margin-top: 0; }
  #usersSection table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
  }
  #usersSection th, #usersSection td {
    padding: 8px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  #usersSection th { background: rgba(255,255,255,0.08); }

  #messages {
    flex: 1 1 auto;
    min-height: 0; /* fixes mobile keyboard resizing */
    overflow-y: auto;
    padding: 10px 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    scroll-behavior: smooth;
  }
  .message {
    padding: 10px 14px;
    border-radius: 20px;
    max-width: 70%;
    word-wrap: break-word;
    font-size: 15px;
    line-height: 1.4;
    position: relative;
  }
  .sent {
    align-self: flex-end;
    background: #0078d7;
    color: white;
    border-bottom-right-radius: 4px;
  }
  .received {
    align-self: flex-start;
    background: rgba(255,255,255,0.1);
    color: white;
    border-bottom-left-radius: 4px;
  }
  .timestamp {
    font-size: 11px;
    color: #aaa;
    margin-top: 4px;
    display: block;
    text-align: right;
  }

  #form {
    flex-shrink: 0;
    display: flex;
    gap: 10px;
    padding: 10px 16px;
    background: rgba(0,0,0,0.15);
    border-top: 1px solid rgba(255,255,255,0.1);
    position: relative;
    z-index: 5;
  }
  #input {
    flex: 1;
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.1);
    color: white;
    font-size: 14px;
    outline: none;
  }
  #form button {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background: #0078d7;
    color: white;
    cursor: pointer;
    font-size: 14px;
  }

  #loginOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
  }
  #loginOverlay input {
    padding: 8px 12px;
    margin-bottom: 10px;
    border-radius: 8px;
    border: none;
    font-size: 14px;
    width: 80%;
    max-width: 250px;
  }
  #loginOverlay button {
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    background: #0078d7;
    color: white;
    cursor: pointer;
    font-size: 14px;
  }

  @media (max-width: 600px) {
    header { font-size: 16px; }
    #input { font-size: 13px; }
    #form button { font-size: 13px; }
    #usersSection { width: 100%; left: -100%; }
    #usersSection.show { left: 0; }
    #messages { padding-bottom: 60px; } /* extra space for input bar */
  }
</style>
</head>
<body>

<div id="loginOverlay">
  <h2>ðŸ‘¤ Login to Borak Chat</h2>
  <input type="text" id="loginName" placeholder="Enter your name"/>
  <input type="email" id="loginEmail" placeholder="Enter your email"/>
  <button id="loginBtn">Login</button>
</div>

<header>
  <span id="headerTitle">ðŸš€ Borak Dashboard v4</span>
  <span id="menuToggle">â˜°</span>
</header>

<div id="usersSection">
  <h2>ðŸ‘¥ Users</h2>
  <table id="usersTable">
    <thead><tr><th>ID</th><th>Name</th><th>Email</th></tr></thead>
    <tbody></tbody>
  </table>
  <form id="addUserForm">
    <input type="text" id="name" placeholder="Name">
    <input type="email" id="email" placeholder="Email">
    <button type="submit" disabled>âž• Add User</button>
  </form>
</div>

<div id="messages"></div>
<form id="form">
  <input id="input" autocomplete="off" placeholder="Type a message..." />
  <button>Send</button>
</form>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const users = [];
const usersTableBody = document.querySelector("#usersTable tbody");
const addUserForm = document.querySelector("#addUserForm");
const addUserButton = addUserForm.querySelector("button");
const headerTitle = document.getElementById("headerTitle");
const loginOverlay = document.getElementById("loginOverlay");
const loginBtn = document.getElementById("loginBtn");
const usersSection = document.getElementById("usersSection");
const messages = document.getElementById("messages");
const form = document.getElementById("form");
const input = document.getElementById("input");
const clientId = Math.random().toString(36).substr(2,9);
let currentUser = null;

function renderUsers(){
  usersTableBody.innerHTML="";
  users.forEach((u,i)=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${i+1}</td><td>${u.name}</td><td>${u.email}</td>`;
    usersTableBody.appendChild(row);
  });
}

addUserForm.addEventListener("submit",(e)=>{
  e.preventDefault();
  const name=document.querySelector("#name").value.trim();
  const email=document.querySelector("#email").value.trim();
  if(!name||!email) return;
  users.push({name,email});
  addUserForm.reset();
  renderUsers();
});

if(localStorage.getItem("borakUser")){
  currentUser=JSON.parse(localStorage.getItem("borakUser"));
  loginOverlay.style.display="none";
  addUserButton.disabled=false;
  if(!users.find(u=>u.email===currentUser.email)) users.push(currentUser);
  renderUsers();
  headerTitle.textContent=`ðŸš€ Borak Dashboard - ${currentUser.name}`;
}

loginBtn.addEventListener("click",()=>{
  const name=document.getElementById("loginName").value.trim();
  const email=document.getElementById("loginEmail").value.trim();
  if(!name||!email) return alert("Enter both name & email");
  currentUser={name,email};
  localStorage.setItem("borakUser",JSON.stringify(currentUser));
  if(!users.find(u=>u.email===email)) users.push(currentUser);
  renderUsers();
  loginOverlay.style.display="none";
  addUserButton.disabled=false;
  headerTitle.textContent=`ðŸš€ Borak Dashboard - ${currentUser.name}`;
});

document.getElementById("menuToggle").addEventListener("click",()=>{usersSection.classList.toggle("show");});
document.addEventListener("click",(e)=>{
  if(!usersSection.contains(e.target)&&!document.getElementById("menuToggle").contains(e.target)){
    usersSection.classList.remove("show");
  }
});

function formatTime(date){return new Date(date).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
function addMessage(msg){
  const div=document.createElement("div");
  div.classList.add("message",msg.sender===clientId?"sent":"received");
  div.innerHTML=`${msg.text}<span class="timestamp">${formatTime(msg.time)}</span>`;
  messages.appendChild(div);
  // auto scroll to bottom
  messages.scrollTop = messages.scrollHeight;
}

form.addEventListener("submit",(e)=>{
  e.preventDefault();
  if(!input.value) return;
  if(!currentUser) return alert("Login first!");
  const msg={text:`${currentUser.name}: ${input.value}`, sender:clientId, time:new Date().toISOString()};
  socket.emit("chat message",msg);
  input.value="";
  addMessage(msg);
});

socket.on("chat message",(msg)=>{if(msg.sender!==clientId) addMessage(msg);});

/* === New additions for responsive height & keyboard handling === */
function adjustMessagesHeight() {
  const headerHeight = document.querySelector('header').offsetHeight;
  const formHeight = document.querySelector('#form').offsetHeight;
  const windowHeight = window.innerHeight;
  messages.style.height = `${windowHeight - headerHeight - formHeight}px`;
}
window.addEventListener('resize', adjustMessagesHeight);
window.addEventListener('orientationchange', adjustMessagesHeight);
window.addEventListener('load', adjustMessagesHeight);
</script>
</body>
</html>
